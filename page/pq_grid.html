<!DOCTYPE html>
<html lang="ko">
@@include('../_include/head.html')

<body>
    <div id="wrap">
        @@include('../_include/header.html')
        <div id="container">
            @@include('../_include/lnb.html')
            <div class="inner">
                <div class="title_wrap">
                    <h2 class="title_lg">접수 내역 테이블</h2>
                </div>
                <div class="content">
                    <div class="grid_wrap">
                        <div id="grid_json"></div>
                    </div>
                    
                    <h2 class="title_lg mt20">보조금 지급 승인 내역 테이블</h2>
                    <div class="grid_wrap">
                        <div id="grid_json2"></div>
                    </div>
                    <ul class="lst_options">
                        <li><a href="javascript:void(0);">접수 상세 정보</a></li>
                        <li><a href="javascript:void(0);">주행 상세 정보</a></li>
                        <li><a href="javascript:void(0);">배차 대기</a></li>
                        <li><a href="javascript:void(0);">배차</a></li>
                        <li><a href="javascript:void(0);">배차 정보 수정</a></li>
                        <li><a href="javascript:void(0);">예약 취소</a></li>
                    </ul>
                    
                    <ul class="lst_status">
                        <li><a href="javascript:void(0);">배차 대기</a></li>
                        <li><a href="javascript:void(0);">배차</a></li>
                        <li><a href="javascript:void(0);">예약 취소</a></li>
                    </ul>
                </div>
            </div>
        </div>

    </div>
</body>
<script>
    $(function () {
        var dataModel = {
           "data": [
                { "no": 1, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "주행 중", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case1" },
                { "no": 2, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "주행 완료", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case2" },
                { "no": 3, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "배차 대기", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case3" },
                { "no": 4, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "배차 완료", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case3" },
                { "no": 5, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "예약 취소", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case3" },
                { "no": 6, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "주행 중", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case3" },
                { "no": 7, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "주행 완료", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case3" },
                { "no": 8, "sido": "전라북도", "sigungu": "고창군", "agency": "고창택시", "center": "고창읍", "status": "배차 대기", "receipt-date": "2022-10-18 12:31:00", "receipt-location": "", "receipt-location": [{ "case": "start", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }, { "case": "pass", "point": "하장백그룹회관", "detail": "전북 무주군 무주읍 한풍루로 30" }, { "case": "end", "point": "마곡그룹회관", "detail": "전북 무주군 무주읍 한풍루로351" }], "receipt-phone": "01023840543", "receipt-personnel": "2", "receipt-date": "2022-10-18 12:31:00", "receipt-plan": "2022-10-18 09:20:00", "receipt-consultant": "이재성", "driver-num": "전북36바3000", "driver-type": "개인", "driver-car": "택시", "driver-charge": "송진혁", "driving-personnel": "2", "driving-intime": "2022-10-18 12:31:00", "driving-outtime": "2022-10-18 12:31:00", "driving-time": "01시 00분 00초", "option": "case3" },
            ]
        };

       function showStatus(rowIndx, grid, tg) {
            var st = $(window).scrollTop();
            var sl = $(window).scrollLeft();

            $(window).scroll(function (evt) {
                $('.lst_status').css({ 'display': 'none' });
                $('.btn_status').removeClass('on');
            });

            $(window).resize(function () {
                $('.lst_status').css({ 'display': 'none' });
                $('.btn_status').removeClass('on');
            });

            if (!tg.hasClass('on')) {
                $('.lst_status').css({
                    'display': 'block',
                    'left': tg.offset().left - $('.lst_status').outerWidth() / 2 + tg.outerWidth() / 2 - sl,
                    'top': tg.offset().top + tg.outerHeight() - st
                });
                tg.addClass('on');
            } else {
                $('.lst_status').css({ 'display': 'none' });
                $('.btn_status').removeClass('on');
            }

            var rowData = grid.getRowData({ rowIndx: rowIndx });
            $('.lst_status li a').removeClass('disabled');

            switch (rowData.status) {
                case '배차 대기':
                    $('.lst_status li a').eq(0).addClass('disabled');
                    break;
                case '배차 완료':
                    $('.lst_status li a').eq(1).addClass('disabled');
                    break;
                case '주행 중':
                    $('.lst_status li a').addClass('disabled');
                    break;
                case '주행 완료':
                    $('.lst_status li a').addClass('disabled');
                    break;
                case '예약 취소':
                    $('.lst_status li a').addClass('disabled');
                    break;
            }
        }

        function showOptions(rowIndx, grid, tg) {
            var st = $(window).scrollTop();
            var sl = $(window).scrollLeft();

            $(window).scroll(function (evt) {
                $('.lst_options').css({ 'display': 'none' });
                $('.btn_more').removeClass('on');
            });

            $(window).resize(function () {
                $('.lst_options').css({ 'display': 'none' });
                $('.btn_more').removeClass('on');
            });

            if (!tg.hasClass('on')) {
                $('.lst_options').css({
                    'display': 'block',
                    'left': tg.offset().left - $('.lst_options').outerWidth() + tg.outerWidth() - sl,
                    'top': tg.offset().top + tg.outerHeight() - st
                });
                tg.addClass('on');
            } else {
                $('.lst_options').css({ 'display': 'none' });
                $('.btn_more').removeClass('on');
            }

            var rowData = grid.getRowData({ rowIndx: rowIndx });
            $('.lst_options li a').removeClass('disabled');

            switch (rowData.status) {
                case '배차 대기':
                    console.log('배차 대기11');
                    $('.lst_options li a').eq(1).addClass('disabled');
                    $('.lst_options li a').eq(2).addClass('disabled');
                    $('.lst_options li a').eq(4).addClass('disabled');
                    break;
                case '배차 완료':
                    $('.lst_options li a').eq(1).addClass('disabled');
                    break;
                case '주행 중':
                    $('.lst_options li a').eq(2).addClass('disabled');
                    $('.lst_options li a').eq(3).addClass('disabled');
                    $('.lst_options li a').eq(5).addClass('disabled');
                    break;
                case '주행 완료':
                    $('.lst_options li a').eq(2).addClass('disabled');
                    $('.lst_options li a').eq(3).addClass('disabled');
                    $('.lst_options li a').eq(4).addClass('disabled');
                    $('.lst_options li a').eq(5).addClass('disabled');
                    break;
                case '예약 취소':
                    $('.lst_options li a').eq(2).addClass('disabled');
                    $('.lst_options li a').eq(3).addClass('disabled');
                    $('.lst_options li a').eq(4).addClass('disabled');
                    $('.lst_options li a').eq(5).addClass('disabled');
                    break;
            }
        }

        $(document).on('click', function (evt) {
            if (!$(evt.target).hasClass('btn_more')) {
                $('.lst_options').css({ 'display': 'none' });
                $('.btn_more').removeClass('on');
            };

            if (!$(evt.target).hasClass('btn_status')) {
                $('.lst_status').css({ 'display': 'none' });
                $('.btn_status').removeClass('on');
            }
        });

        var colModel = [
            /* { dataIndx: "state", maxWidth: 60, minWidth: 60, align: "center", resizable: false,
                title: "",
                menuIcon: false,
                type: 'checkBoxSelection', cls: 'ui-state-default', sortable: false, editor: false,
                dataType: 'bool',
                cb: {
                    all: false, //checkbox selection in the header affect current page only.
                    header: true, //show checkbox in header. 
                    select: true 
                }
            }, */
            { title: "No", dataIndx: "no", width: 60, nodrag: true, nodrop: true,  },
            { title: "시도", dataIndx: "sido", width: 80, nodrag: true, nodrop: true, },
            { title: "시군구", dataIndx: "sigungu", width: 80, nodrag: true, nodrop: true, },
            { title: "소속기관", dataIndx: "agency", width: 80, nodrag: true, nodrop: true, },
            { title: "센터", dataIndx: "center", width: 80, nodrag: true, nodrop: true, },
            {
                title: "주행 상태", dataIndx: "status", width: 90, nodrag: true, nodrop: true,
                render: function (ui) {
                    var rowData = ui.rowData, dataIndx = ui.dataIndx;
                    var val = rowData[dataIndx];
                    var lst;
                    if (val === '주행 중') {
                        return "<button type='button' class='btn_status state state_green'>" + val + "</button>";
                    } else if( val ==='주행 완료') {
                        return "<button type='button' class='btn_status state state_navy'>" + val + "</button>";
                    } else if (val === '배차 대기') {
                        return "<button type='button' class='btn_status state state_red'>" + val + "</button>";
                    } else if (val === '배차 완료') {
                        return "<button type='button' class='btn_status state state_blue'>" + val + "</button>";
                    } else if (val === '예약 취소') {
                        return "<button type='button' class='btn_status state state_gray'>" + val + "</button>";
                    }
                     // var result = "<button type='button' class='btn_sate'>" + val + "</button>";
                    // return result;
                },
                postRender: function (ui) {
                    var rowIndx = ui.rowIndx,
                        grid = this,
                        $cell = grid.getCell(ui);

                    $cell.find(".btn_status").bind("click", function (evt) {
                        var tg = $(this);
                        showStatus(rowIndx, grid, tg);
                    });
                },

            },

            {
                title: "<span class='header_title'>접수 정보<span>", dataIndx: "receipt", nodrag: true, align: "center", style: "padding:3px 10px",
                colModel: [
                    { title: "접수 일시", dataIndx: "receipt-date", width: 100, nodrag: true,},
                    { title: "탑승지/하차지", dataIndx: "receipt-location", width: 240, align: "left", nodrag: true, sortable: false, cls: "hd_line",
                        render: function (ui) { // checkbox custom
                            var items = ui.cellData;
                            var ul = `<ul class='location_lst'>`;
                            var ul_end = `</ul>`;
                            var li = '';
                            var cls = '';
                            for (var i = 0; i < items.length; i++) {
                                if (items[i].case === 'start') {
                                    cls = 'icon_location1';
                                } else if (items[i].case === 'pass') {
                                    cls = 'icon_location2';
                                } else {
                                    cls = 'icon_location3';
                                }
                                li += `<li><i class='icon ${cls}'></i><span><strong>${items[i].point}</strong>(${items[i].detail})</span></li>`
                            }
                            result = ul + li + ul_end;
                            return result;
                        }
                    },
                    { title: "예약자 전화번호", dataIndx: "receipt-phone", width: 120, nodrag: true, nodrop: true, cls: "hd_line",},
                    { title: "예약자 인원", dataIndx: "receipt-personnel", width: 90, nodrag: true, nodrop: true, cls: "hd_line",},
                    { title: "탑승 예정 일시", dataIndx: "receipt-plan", width: 100, nodrag: true, nodrop: true, cls: "hd_line",},
                    { title: "상담원", dataIndx: "receipt-consultant", width: 80, nodrag: true, nodrop: true, cls: "hd_line",},
                ]
            },

            {
                title: "<span class='header_title'>기사 정보<span>", dataIndx: "driver", nodrag: true, nodrop: true, align: "center",
                colModel: [
                    { title: "차량번호", dataIndx: "driver-num", width: 100, nodrag: true, nodrop: true, sortable: false, },
                    { title: "기사 구분", dataIndx: "driver-type", width: 100, nodrag: true, nodrop: true, sortable: false, cls: "hd_line",},
                    { title: "차량유형", dataIndx: "driver-car", width: 100, nodrag: true, nodrop: true, sortable: false, cls: "hd_line",},
                    { title: "담당 기사", dataIndx: "driver-charge", width: 100, nodrag: true, nodrop: true, cls: "hd_line",},
                ]
            },
            {
                title: "<span class='header_title'>주행 정보<span>", dataIndx: "driving", nodrag: true, nodrop: true, align: "center",
                colModel: [
                    { title: "탑승 인원", dataIndx: "driving-personnel", width: 100, nodrag: true,  sortable: false, },
                    { title: "탑승 일시", dataIndx: "driving-intime", width: 100, nodrag: true,  cls: "hd_line",},
                    { title: "하차 일시", dataIndx: "driving-outtime", width: 100, nodrag: true,  cls: "hd_line",},
                    { title: "주행 시간", dataIndx: "driving-time", width: 100, nodrag: true,  cls: "hd_line",},
                ]
            },

            {
                title: "옵션", dataIndx: "option", width: 60, maxWidth: 60, minWidth: 60, nodrag: true, sortable: false,
                render: function (ui) {
                    var rowData = ui.rowData, dataIndx = ui.dataIndx;
                    var val = rowData[dataIndx];
                    var lst;

                    var result = "<i class='btn_more icon icon_option'><span class='sr_only'>더보기</span></i>";
                    return result;
                },
                postRender: function (ui) {
                    var rowIndx = ui.rowIndx,
                        grid = this,
                        $cell = grid.getCell(ui);

                    $cell.find(".btn_more").bind("click", function (evt) {
                        var tg = $(this);
                        showOptions(rowIndx, grid, tg);
                    });
                },
            },
        ];


        var options = {
            width: 'auto',
            minWidth: 980,
            minHeight: 200,
            rowHt: 50,
            rowHtHead: 36,
            collapsible: { on: false, toggle: false },

            columnBorders: true,
            rowBorders: true,
            stripeRows: true,

            postRenderInterval: -1, //synchronous post rendering.
            dataModel: dataModel,
            colModel: colModel,
            selectionModel: { type: 'row', mode: 'block' },

            columnTemplate: {
                align: 'center', valign: 'center'
            },
            editable: false,
            freezeCols: 0,
            freezeRows: 0,

            numberCell: { show: false },
            reactive: true,
            roundCorners: false,
            resizable: true,

            showHeader: true,
            showTitle: false,
            showToolbar: false,
            showTop: false,
            showBottom: false,
            virtualX: true, virtualY: true,

            title: "",
            strNoRows: '조회된 데이터가 없습니다.',
        };
        var grid = pq.grid("#grid_json", options);


        var dataModel2 = {
            "data": [
                { "no": 1, "approval-status": "승인 대기", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "", "fare1": "1,500", "fare2": "1,000", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 2, "approval-status": "승인 대기", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 3, "approval-status": "승인 완료", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 4, "approval-status": "정상", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 5, "approval-status": "비정상", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 6, "approval-status": "승인 대기", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 7, "approval-status": "승인 대기", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 8, "approval-status": "승인 대기", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 9, "approval-status": "승인 대기", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
                { "no": 10, "approval-status": "승인 대기", "verification": "정상", "sido": "경상남도", "sigungu": "창원시", "agency": "창원시", "center": "창원시청", "driving-intime": "2022-10-27 18:30:00", "driving-outtime": "2022-10-27 18:45:00", "receipt-location": [{ "case": "start", "detail": "부산 해운대구 중동 1015" }, { "case": "end", "detail": "부산 해운대구 남동 26" }], "receipt-location-matching": [{ "case": "start", "point": "등촌마을(상남면)" }, { "case": "end", "point": "신나면사무소" }], "driving-personnel": "1", "total-charge": "9,000", "passenger-paid-fare": "1500", "fare1": "", "fare2": "", "subsidy": "7,500", "total-driving-time": "00:05:30", "total-distance": "4.312", "car_num": "강원123사 5678", "driver-type": "개인", "car_type": "택시", "driver-charge": "택시", "driver-charge": "이재성", "driving-photo": "" },
            ]
        };

        var colModel2 = [
            { dataIndx: "state", maxWidth: 60, minWidth: 60, align: "center", resizable: false,
                title: "",
                menuIcon: false,
                type: 'checkBoxSelection', cls: 'ui-state-default', sortable: false, editor: false,
                dataType: 'bool', 
                cb: {
                    all: false, //checkbox selection in the header affect current page only.
                    header: true, //show checkbox in header. 
                    select: true,
                },
                editable: function (ui) {
                    return !ui.rowData.disabled
                },
            },
            { title: "No", dataIndx: "no", width: 60, nodrag: true, nodrop: true, },
            { title: "승인 상태", dataIndx: "approval-status", width: 80, nodrag: true, nodrop: true, },
            { title: "검증 여부", dataIndx: "verification", width: 80, nodrag: true, nodrop: true, },
            { title: "시도", dataIndx: "sido", width: 80, nodrag: true, nodrop: true,},
            { title: "시군구", dataIndx: "sigungu", width: 80, nodrag: true, nodrop: true, },
            { title: "소속기관", dataIndx: "agency", width: 80, nodrag: true, nodrop: true, },
            { title: "센터", dataIndx: "center", width: 80, nodrag: true, nodrop: true, },
            { title: "탑승 일시", dataIndx: "driving-intime", width: 100, nodrag: true, nodrop: true, },
            { title: "하차 일시", dataIndx: "driving-outtime", width: 100, nodrag: true, nodrop: true, },
            { title: "탑승지/하차지", dataIndx: "receipt-location", width: 240, align: "left", nodrag: true, nodrop: true,
                render: function (ui) { // checkbox custom
                    var items = ui.cellData;
                    var ul = `<ul class='location_lst'>`;
                    var ul_end = `</ul>`;
                    var li = '';
                    var cls = '';

                    for (var i = 0; i < items.length; i++) {
                        if (items[i].case === 'start') {
                            cls = 'icon_location1';
                        } else {
                            cls = 'icon_location3';
                        }
                        li += `<li><i class='icon ${cls}'></i><span><strong>${items[i].detail}</strong></span></li>`
                    }
                    result = ul + li + ul_end;
                    return result;
                }
            },
            { title: "탑승지/하차지<br>(승하차지점 매칭)", dataIndx: "receipt-location-matching", width: 240, align: "left", nodrag: true, nodrop: true,
                render: function (ui) { // checkbox custom
                    // console.log(ui.rowData);
                    let location_lst = `<ul class='location_lst'>`;
                    let lst1 = `<li><i class='icon icon_location1'></i><span><strong>${ui.rowData.case1}</strong></span></li>`;
                    let lst2 = `<li><i class='icon icon_location3'></i><span><strong>${ui.rowData.case2}</strong></span></li>`;

                    location_lst += `${lst1}${lst2}`;

                    return location_lst += `</ul>`;
                }
            },
            { title: "탑승 인원", dataIndx: "driving-personnel", width: 100, nodrag: true, nodrop: true, },
            { title: "총 요금", dataIndx: "total-charge", width: 100, nodrag: true, nodrop: true, },
            { title: "승객 지불 요금", dataIndx: "passenger-paid-fare", width: 90, nodrag: true, nodrop: true,
                render: function (ui) { // checkbox custom
                    var items = ui.cellData;
                    var ul = `<ul class='location_lst'>`;
                    var ul_end = `</ul>`;
                    var li = '';
                    var cls = '';

                    for (var i = 0; i < items.length; i++) {
                        if (items[i].case === 'start') {
                            cls = 'icon_location1';
                        } else {
                            cls = 'icon_location3';
                        }
                        li += `<li><i class='icon ${cls}'></i><span><strong>${items[i].point}</strong></span></li>`
                    }
                    result = ul + li + ul_end;
                    return result;
                }
            },
            { title: "보조금", dataIndx: "subsidy", width: 100, nodrag: true, nodrop: true, },
            { title: "총 주행 시간", dataIndx: "total-driving-time", width: 100, nodrag: true, nodrop: true, },
            { title: "총 주행 거리(km)", dataIndx: "total-distance", width: 100, nodrag: true, nodrop: true, },
            { title: "차량 번호", dataIndx: "car_num", width: 80, nodrag: true, nodrop: true, },
            { title: "기사 구분", dataIndx: "driver-type", width: 80, nodrag: true, nodrop: true, },
            { title: "차량 구분", dataIndx: "car_type", width: 80, nodrag: true, nodrop: true, },
            { title: "담당 기사", dataIndx: "driver-charge", width: 80, nodrag: true, nodrop: true, },
            { title: "주행 증빙 사진", dataIndx: "driving-photo", width: 80, nodrag: true, nodrop: true,
                render: function (ui) { // checkbox custom
                    var rowData = ui.rowData, dataIndx = ui.dataIndx;
                    var val = rowData[dataIndx];
                    if (val === '파일없음') {
                        return "<i class='icon icon_unfile'></i>";
                    } else {
                        return "<i class='icon icon_onfile'></i>"
                    }
                },
            },
             { title: "상세 보기", dataIndx: "view-details", width: 80, nodrag: true, nodrop: true,
                render: function (ui) { // checkbox custom
                     var rowData = ui.rowData, dataIndx = ui.dataIndx;
                     var val = rowData[dataIndx];
                     var result = "<i class='btn_detail icon icon_search'><span class='sr_only'>상세보기</span></i>";
                     return result;
                 },
            },
        ];
        var options2 = {
            scrollModel: { autoFit: false },
            width: 'auto',
            minWidth: 980,
            minHeight: 300,
            rowHt: 92,
            rowHtHead: 64,
            collapsible: { on: false, toggle: false },

            columnBorders: true,
            rowBorders: true,
            stripeRows: true,

            // postRenderInterval: -1, //synchronous post rendering.
            dataModel: dataModel2,
            colModel: colModel2,
            // selectionModel: { type: 'row', mode: 'block' },

            columnTemplate: {
                align: 'center', valign: 'center'
            },
            editable: false,
            freezeCols: 0,
            freezeRows: 0,

            numberCell: { show: false },
            reactive: true,
            roundCorners: false,
            resizable: false,

            showHeader: true,
            showTitle: false,
            showToolbar: false,
            showTop: false,
            showBottom: false,
            virtualX: true,
            virtualY: true,

            title: "",
            strNoRows: '조회된 데이터가 없습니다.',

            rowSelect: function (evt, ui) {
                console.log('rowSelect', ui);
            },
            selectChange: function (evt, ui) {
                console.log('selectChange', evt, ui);

            },
        };
        var grid = pq.grid("#grid_json2", options2);
    });
</script>

</html>